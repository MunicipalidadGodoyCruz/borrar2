"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"undefined"==typeof L&&(L={}),L.Pie={version:"0.1.0",Control:{},Util:{}},"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=L.Pie:"function"==typeof define&&define.amd&&define(L.Pie),L.Pie.Util.slugify=function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},L.Pie.Util.scaled_diameter=function(e,t,i){var o=i/(2*Math.sqrt(parseFloat(t))/Math.PI);return 2*Math.sqrt(parseFloat(e))*o/Math.PI},L.Pie.Util.compensated_diameter=function(e,t,i){return 1.0083*Math.pow(e/t,.5716)*i},L.Pie.Util.drawPie=function(e,t,i,o){for(var s="<div class='lpie-icon'><svg class='lpie-icon__pie' width="+t+" height="+t+" viewBox='0 0 2 2'>",l=0,a=1+Math.cos(l),n=1+Math.sin(l),r=0;r<i.length;r++){var c=i[r]*Math.PI*2/e,p=c>Math.PI?1:0;s+="<path class='lpie-icon__slice cat--"+L.Pie.Util.slugify(o.categories[r].label)+"'"+(o.hover_callback?" onmouseover='"+o.hover_callback+"(this, this.parent)'":"")+" data-value='"+i[r]+"'data-category='"+o.categories[r].label+"' data-color='"+o.categories[r].color+"' fill='"+o.categories[r].color+"' d='M "+a+" "+n+" A 1 1 0 ",l+=c,s+=p+" 1 "+(a=1+Math.cos(l))+" "+(n=1+Math.sin(l))+" L 1 1 Z' />"}if(s+="</svg>",o.default_hover){s+="<ul class='lpie-icon__tooltip "+(o.hover_classes?o.hover_classes:"")+" '>";for(r=0;r<i.length;r++)s+="            <li class='lpie-icon__tooltip-item'>                <p class='lpie-icon__tooltip-label'>                    <i class='lpie-icon__tooltip-color-icon' style='color: "+o.categories[r].color+"'></i>"+o.categories[r].label+"</p>                <p class='lpie-icon__tooltip-value'>"+i[r]+" "+o.units+"</p>            </li>";return s+"</ul></div>"}return s+"</div>"},L.Pie.Dataset=L.Class.extend({data:{},min_value:Number.MAX_VALUE,displays:{},legends:{},initialize:function(e){this.data=e;var t=Number.MAX_VALUE;e.forEach(function(e){e.sum=e.data.reduce(function(e,t){return e+t}),e.sum<t&&(t=e.sum)}),this.min_value=t},get:function(){return this.data},addDisplay:function(e,t){this.displays[e]=t},addLegend:function(e,t,i){i&&(t.categories=this.displays[i].categories),this.legends[e]=t},marker:function(e,t,i){var o=void 0;o=t.compensation?L.Pie.Util.compensated_diameter(e.sum,this.min_value,t.min_size):L.Pie.Util.scaled_diameter(e.sum,this.min_value,t.min_size);var s=L.divIcon({className:"leaflet-pie",iconSize:[o,o],iconAnchor:[o/2,o/2],html:L.Pie.Util.drawPie(e.sum,o,e.data,t)});return L.marker(e.coords,{icon:s})},displaySet:function(e,t){var i=this.displays[e];for(var o in this.data){var s=this.data[o],l=this.marker(s,i);l.addTo(t),i.popup&&l.bindPopup(i.popup(s))}},displayLegend:function(e,t){L.Pie.Control.datasetLegend(this.legends[e]).addTo(t)}}),L.Pie.dataset=function(e){return new L.Pie.Dataset(e)},L.Pie.Control.DatasetLegend=L.Control.extend({options:{position:"topright",title:"",description:"",source_text:"",source_url:"",labels:[],dataset:{},legend_classes:""},initialize:function(e){L.setOptions(this,e)},_legend:function(){var e="<ul class='lpie-legend__categories'>";return this.options.categories.forEach(function(t){e+=L.Util.template("<li class='{i_cl}'><span class={co_cl} style='color: {item_color}'></span><span class='{ca_cl}'>{item_name}</span></li>",{i_cl:"lpie-legend__categories-item",item_color:t.color,item_name:t.label,co_cl:"lpie-legend__color-icon",ca_cl:"lpie-legend__categories-label"})}),e+="</ul>"},_source:function(){var e=""!=this.options.source_text,t=""!=this.options.source_url;if(e){var i="";return i=t?"<a href='{s_url}' target='_blank'>{s_txt}</a>":"<a href='{s_url} target='_blank'>{s_txt}</a>",L.Util.template("<span class='sl_cl'>Source: </span>"+i,{s_url:this.options.source_url,s_txt:this.options.source_text})}return""},onAdd:function(){return this._container=L.DomUtil.create("div","lpie-legend "+this.options.legend_classes),this._container.innerHTML=L.Util.template('<p class="{t_cl}">{t}</p><p class="{p_cl}">{d}</p>{l}<div class="{s_cl}">{s}</div>',{t:this.options.title,d:this.options.description,l:this._legend(),s:this._source(),t_cl:"lpie-legend__title",p_cl:"lpie-legend__description",s_cl:"lpie-legend__source"}),this._container}}),L.Pie.Control.datasetLegend=function(e){return new L.Pie.Control.DatasetLegend(e)};